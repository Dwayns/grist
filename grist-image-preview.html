<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  <style>
    body {
      margin: 0;
      padding: 8px;
      font-family: sans-serif;
    }
    .thumbs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border: 1px solid #ddd;
    }
  </style>
</head>

<body>
  <div class="thumbs" id="thumbs"></div>

  <script>
    grist.ready({
      columns: [
        { name: "images", title: "Images", type: "Text" }
      ],
      requiredAccess: "read table"
    });

    const container = document.getElementById("container");

    grist.onRecord(function(record) {

      function renderImages(value) {
        const container = document.getElementById("images");
        if (!container) return; // sécurité Grist

        container.innerHTML = "";

        if (!value) return;

        // accepte :
        // - une seule URL
        // - plusieurs URLs séparées par , ou ;
        const urls = Array.isArray(value)
          ? value
          : value.toString().split(/[;,]/).map(u => u.trim()).filter(Boolean);

        for (const url of urls) {
          const img = document.createElement("img");
          img.src = url;
          img.loading = "lazy";
          img.referrerPolicy = "no-referrer";
          img.style.maxWidth = "100%";
          img.style.marginBottom = "6px";

          img.onerror = () => {
            img.remove(); // évite vignette cassée
          };

          container.appendChild(img);
        }
      }

      renderImages(record.images); // ⚠️ nom exact de la colonne
    });

    console.log("Images brutes :", record.Images);
  </script>
</body>
</html>
